{% extends "base.html" %}

{% block title %}{% if roadmap %}Edit{% else %}Add{% endif %} Roadmap - Admin{% endblock %}

{% block content %}
<div class="container">
    <div class="section">
        <div class="flex-between mb-4">
            <h1>{% if roadmap %}Edit{% else %}Add New{% endif %} Roadmap <span class="badge badge-admin">ADMIN</span>
            </h1>
            <a href="{{ url_for('admin_roadmaps') }}" class="btn btn-outline">Back to Roadmaps</a>
        </div>

        <!-- Roadmap Form -->
        <div class="card mb-4">
            <h2 class="mb-3">Roadmap Details</h2>
            <form method="POST"
                action="{% if roadmap %}{{ url_for('edit_roadmap', roadmap_id=roadmap.id) }}{% else %}{{ url_for('add_roadmap') }}{% endif %}">
                {{ form.hidden_tag() }}

                <div class="form-group">
                    <label for="title" class="form-label">Roadmap Title *</label>
                    {{ form.title(class="form-control", placeholder="e.g., Python Programming Mastery") }}
                    {% if form.title.errors %}
                    {% for error in form.title.errors %}
                    <div class="form-error">{{ error }}</div>
                    {% endfor %}
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="description" class="form-label">Description *</label>
                    {{ form.description(class="form-control", rows="4", placeholder="Describe what learners will achieve
                    with this roadmap...") }}
                    {% if form.description.errors %}
                    {% for error in form.description.errors %}
                    <div class="form-error">{{ error }}</div>
                    {% endfor %}
                    {% endif %}
                </div>

                <div class="grid grid-2">
                    <div class="form-group">
                        <label for="category" class="form-label">Category *</label>
                        {{ form.category(class="form-control") }}
                        {% if form.category.errors %}
                        {% for error in form.category.errors %}
                        <div class="form-error">{{ error }}</div>
                        {% endfor %}
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="difficulty" class="form-label">Difficulty Level *</label>
                        {{ form.difficulty(class="form-control") }}
                        {% if form.difficulty.errors %}
                        {% for error in form.difficulty.errors %}
                        <div class="form-error">{{ error }}</div>
                        {% endfor %}
                        {% endif %}
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">
                    {% if roadmap %}Update Roadmap{% else %}Create Roadmap{% endif %}
                </button>
            </form>
        </div>

        <!-- Steps Management (only for existing roadmaps) -->
        {% if roadmap %}
        <div class="card">
            <h2 class="mb-3">Roadmap Steps ({{ roadmap.get_total_steps() }})</h2>

            <!-- Existing Steps -->
            {% if roadmap.steps %}
            <ul class="steps-list mb-4">
                {% for step in roadmap.steps %}
                <li class="step-item">
                    <div class="step-header">
                        <span class="step-number">Step {{ step.step_number }}</span>
                        <h4 class="step-title">{{ step.title }}</h4>
                        <form method="POST" action="{{ url_for('delete_step', step_id=step.id) }}"
                            style="display: inline;">
                            <button type="submit" class="btn btn-danger btn-sm"
                                onclick="return confirmDelete('Delete this step?')">
                                Delete
                            </button>
                        </form>
                    </div>
                    <p class="step-description">{{ step.description }}</p>
                    {% if step.resources %}
                    <div class="step-resources">
                        <strong style="color: var(--electric-blue); font-size: 0.875rem;">Resources:</strong><br>
                        <span style="color: var(--text-secondary); font-size: 0.875rem;">{{ step.resources }}</span>
                    </div>
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
            {% endif %}

            <!-- Add New Step Form -->
            <div class="card-glass" style="padding: 1.5rem;">
                <h3 class="mb-3">Add New Step</h3>
                <form method="POST" action="{{ url_for('add_step', roadmap_id=roadmap.id) }}">
                    <div class="form-group">
                        <label for="title" class="form-label">Step Title *</label>
                        <input type="text" name="title" class="form-control"
                            placeholder="e.g., Understanding Variables and Data Types" required>
                    </div>

                    <div class="form-group">
                        <label for="description" class="form-label">Step Description *</label>
                        <textarea name="description" class="form-control" rows="3"
                            placeholder="Detailed description of what to learn in this step..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="resources" class="form-label">Resources (one per line)</label>
                        <textarea name="resources" class="form-control" rows="3"
                            placeholder="https://example.com/tutorial&#10;Python Official Documentation&#10;Video: Introduction to Python"></textarea>
                    </div>

                    <button type="submit" class="btn btn-success">âž• Add Step</button>
                </form>
            </div>
        </div>
        {% else %}
        <div class="card card-glass text-center" style="padding: 2rem;">
            <p style="color: var(--text-secondary);">
                Save the roadmap first, then you can add steps to it.
            </p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}